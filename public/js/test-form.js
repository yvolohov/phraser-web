!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class s{constructor(){this.pattern=new RegExp("^[A-Za-zА-Яа-я0-9'\"-]$"),this.SPACE=0,this.LETTER=1,this.ANOTHER=2}tokenizeSentence(e){let t=[],n=!1,s=e.trim(),i=s.substr(0,1);for(let e=1;e<s.length;e++){let o=s.substr(e-1,1),r=s.substr(e,1),a=this._getSymbolType(o),d=this._getSymbolType(r);a===d||n||(t.push(i),i="",n=!0),d>0&&(i+=r,n=!1)}return i.length>0&&t.push(i),t}_getSymbolType(e){const t=e.charCodeAt(0);return 9===t||32===t?this.SPACE:null!==this.pattern.exec(e)?this.LETTER:this.ANOTHER}}class i{constructor(){this.tokenizer=new s,this.STATE_BLUE="#436EEE",this.STATE_RED="#FF0000",this.STATE_GREEN="#008000"}getState(e,t){const n=this.tokenizer.tokenizeSentence(e),s=this.tokenizer.tokenizeSentence(t);if(n.length<s.length)return this.STATE_RED;for(let e=0;e<n.length;e++){let t=n[e],i=e<s.length?s[e]:"",o=t.toUpperCase(),r=i.toUpperCase();if(o!==r)return 0===o.indexOf(r)?this.STATE_BLUE:this.STATE_RED}return this.STATE_GREEN}getHints(e,t){let n="",s="",i=e;const o=this.tokenizer.tokenizeSentence(e),r=this.tokenizer.tokenizeSentence(t);for(let e=0;e<o.length;e++){let t=o[e],i=e<r.length?r[e]:"";if(t.toUpperCase()===i.toUpperCase()){n=n+(e>0?" ":"")+t,s=s+(e>0?" ":"")+t;continue}let a="";for(let e=0;e<t.length;e++){let n=t.charAt(e),s=e<i.length?i.charAt(e):"",o=n.toUpperCase(),r=s.toUpperCase();if(a+=n,o!==r)break}n=n+(e>0?" ":"")+a,s=s+(e>0?" ":"")+t;break}return{addedSymbol:n,addedWord:s,addedAll:i}}}class o{constructor(e){this.comparator=new i,this.ie=e,this.root="",this.questions=[],this.questionIndex=-1}startTest(){const e=new XMLHttpRequest;e.open("GET",`${this.root}/api/phrases`,!0),e.send(),e.onreadystatechange=this._start.bind(this,e)}answer(){let e=this.questions[this.questionIndex].id,t=this.questions[this.questionIndex].phrase,n=this.ie.input.answer.value;if(this.comparator.getState(t,n)===this.comparator.STATE_GREEN){const t=new XMLHttpRequest;t.open("PUT",`${this.root}/api/phrases/${e}`,!0),t.send(),t.onreadystatechange=function(e){4===e.readyState&&200!==e.status&&console.log(e.status+": "+e.responseText)}.bind(this,t),this._next()}this.ie.input.answer.focus()}processFieldChange(e){this._updateFieldColor(),13===e&&this.answer()}openNextSymbol(){this._updateFieldValueFromHint("addedSymbol"),this._updateFieldColor()}openNextWord(){this._updateFieldValueFromHint("addedWord"),this._updateFieldColor()}openAll(){this._updateFieldValueFromHint("addedAll"),this._updateFieldColor()}_start(e){if(4!==e.readyState)return;if(200!==e.status)return void console.log(e.status+": "+e.responseText);const t=JSON.parse(e.responseText);if(this._setVisibility(this.ie.div.startScreenElements,!1),this._setVisibility(this.ie.div.mainScreenElements,!0),0===t.length)return this.ie.div.progress.innerText="",void(this.ie.div.question.innerText="Error: Cannot load questions from DB !!!");this.ie.input.answer.removeAttribute("disabled"),this.ie.input.answer.focus(),this.ie.button.answer.removeAttribute("disabled"),this.ie.button.openSymbol.removeAttribute("disabled"),this.ie.button.openWord.removeAttribute("disabled"),this.ie.button.openSentence.removeAttribute("disabled"),this.questions=t,this._next()}_next(){if(this.questionIndex++,this.questionIndex>=this.questions.length)return void this._end();const e=`Q. ${this.questionIndex+1} : ${this.questions.length}`,t=this.questions[this.questionIndex].translation;this.ie.div.progress.innerText=e,this.ie.div.question.innerText=t,this.ie.input.answer.value="",this._updateFieldColor()}_end(){this.ie.div.question.innerText="Test is passed !!!",this.ie.input.answer.value="",this.ie.input.answer.setAttribute("disabled","disabled"),this.ie.button.answer.setAttribute("disabled","disabled"),this.ie.button.openSymbol.setAttribute("disabled","disabled"),this.ie.button.openWord.setAttribute("disabled","disabled"),this.ie.button.openSentence.setAttribute("disabled","disabled")}_updateFieldValueFromHint(e){let t=this.questions[this.questionIndex].phrase,n=this.ie.input.answer.value,s=this.comparator.getHints(t,n);this.ie.input.answer.value=s[e]}_updateFieldColor(){let e=this.questions[this.questionIndex].phrase,t=this.ie.input.answer.value,n=this.comparator.getState(e,t);this.ie.input.answer.style.color=n}_setVisibility(e,t){for(let n of e)n.style.display=t?"block":"none"}}window.addEventListener("load",()=>{const e=(()=>({button:{start:document.getElementById("button-start"),answer:document.getElementById("button-answer"),openSymbol:document.getElementById("button-open-symbol"),openWord:document.getElementById("button-open-word"),openSentence:document.getElementById("button-open-sentence")},input:{answer:document.getElementById("input-answer")},div:{startScreenElements:document.getElementsByClassName("start-screen"),mainScreenElements:document.getElementsByClassName("main-screen"),question:document.getElementById("text-question"),progress:document.getElementById("text-progress")}}))(),t=new o(e);e.button.start.addEventListener("click",e=>{t.startTest()}),e.button.answer.addEventListener("click",e=>{t.answer()}),e.button.openSymbol.addEventListener("click",e=>{t.openNextSymbol()}),e.button.openWord.addEventListener("click",e=>{t.openNextWord()}),e.button.openSentence.addEventListener("click",e=>{t.openAll()}),e.input.answer.addEventListener("keyup",e=>{t.processFieldChange(e.keyCode)})})}]);